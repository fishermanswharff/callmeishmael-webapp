"use strict";function navbarController(a,b,c){var d=this;c.currentUser(),d.isLoggedIn=function(){return c.isAuthenticated()},d.logout=function(){c.logout().then(function(a){b.path("/login")})}}function loginController(a,b,c,d){var e=this;e.login=function(a){$(loginForm).find("button[type=submit] i.fa").addClass("fa-cog fa-spin"),c.login(a).then(function(a){b.path("/dashboard")})},e.confirm=function(a){var e=b.search(),f={id:e.userId,email:e.userEmail,password:a.password,password_confirmation:a.password_confirmation,confirmed:!0};c.updateUser(f).then(function(a){d("response from updateUser: ",a),b.url("/")})},e.showPasswordForm=function(){e.forgotPassword=!e.forgotPassword},e.sendPasswordLink=function(b){$(resetPasswordForm).find("button[type=submit] i.fa").addClass("fa-cog fa-spin"),c.sendPasswordLink(b).then(function(b){200===b.status?(a.$broadcast("alert",{alert:"Your email has been sent. If you did not receive it please check your spam box.",status:b.status}),$(resetPasswordForm).find("button[type=submit] i.fa").addClass("fa-check").removeClass("fa-cog fa-spin")):(a.$broadcast("alert",{alert:"We do not have a record of your email address.",status:b.status}),$(resetPasswordForm).find("button[type=submit] i.fa").addClass("fa-times").removeClass("fa-cog fa-spin"))})},e.resetPassword=function(a){d("resetting password");var e=b.search(),f={id:e.userId,email:e.userEmail,password:a.password,password_confirmation:a.password_confirmation,confirmed:!0};c.submitNewPassword(f).then(function(a){b.url("/")})}}function sidenavController(a,b,c){var d=this;d.isActive=function(a){return b.path()===a}}function dashboardController(a,b,c,d,e){var f=this;f.phones=[],f.stories=[],f.storyTypes=e(),f.venues=b.venues,f.phones=c.phones,f.stories=d.stories,f.activeVenues=function(){var a=[];return f.venues.map(function(b,c){"active"===b.status&&a.push(b)}),a.length},f.pausedVenues=function(){var a=[];return f.venues.map(function(b,c){"paused"===b.status&&a.push(b)}),a.length},f.deleteObject=function(e){a(e);for(var f in e)switch(f){case"story":d.destroy(e).then(function(a){fetchStories()});break;case"venue":b.destroy(e).then(function(a){fetchVenues()});break;case"phone":c.destroy(e).then(function(a){fetchPhones()})}}}function homeController(a,b,c){{var d=document.getElementById("scene");new Parallax(d)}}function formsController(a,b,c,d,e,f,g,h,i){var j=function(a,b,c){return"active"===a.status},k=this;k.storyTypes=["Fixed","Venue","Surprise","Ishmael’s","Post Roll"],k.phoneStatus=["active","inactive","retired","fixable"],k.phones=d.phones,k.stories=e.stories,k.users=c.users,f.fetch().then(function(a){k.venues=a.filter(j)}),k.story={},k.venueStory={},k.phone={},k.venue={},k.submit=function(b){for(var c in b)switch(c){case"story":l(b);break;case"phone":d.post(b).then(function(b){a(b)}),k.phone={},a("phone is the object");break;case"venue":f.post(b).then(function(b){a(b)}),k.venue={},a("venue is the object");break;case"user":m(b),k.newUser={}}};var l=function(a){if("Venue"===a.story.story_type&&void 0===a.story.venue_id)return void h.$broadcast("alert",{alert:"Please choose a venue for the story",status:400});var c=o();c.length>0?g.sendToAmazon(c[0]).then(function(c){var d;h.$watch("awsResponse",function(c,g){c&&204===c.status&&(d=c.headers().location,b.all(n(a,d)).then(function(b){if(a.story.venue_id){var c=b[0];f.addStoryToVenue(a.story.venue_id,c.id)}k.story={},$(storyForm).find("input[type=file]").val(null),e.fetch()}))})}):b.all(n(a)).then(function(b){if(a.story.venue_id){var c=b[0];f.addStoryToVenue(a.story.venue_id,c.id)}k.story={},$(storyForm).find("input[type=file]").val(null),e.fetch()})},m=function(b){if(b.user.venueId){var d=b.user.venueId;delete b.user.venueId,b.user.password="secret",c.postNewUser(b).then(function(a){f.patch({venue:{user_id:a.data.id}},d)})}else b.user.password="secret",c.postNewUser(b).then(function(b){a(b)})},n=function(a,b){var c=[];return c.push(e.post(a,b)),c},o=function(){for(var a=[],b=$(storyForm).find("input[type=file]"),c=0,d=b.length;d>c;c++){var e=b[c].files[0];e&&a.push(e)}return a};k.deleteObject=function(b){a(b);for(var c in b)switch(c){case"story":e.destroy(b).then(function(a){e.fetch()});break;case"venue":f.destroy(b).then(function(a){f.fetch()});break;case"phone":d.destroy(b).then(function(a){d.get()})}},k.normalizeStoryTitle=function(a){return e.normalize(a)},k.clearForm=function(){k.story={},k.isEditing=!k.isEditing};var p=function(a,b){k.story=b.story,k.isEditing=!!k.story.id};h.$on("editStory",p)}function venueController(a,b,c,d,e,f,g,h){var i=this;if(i.venue={},i.userVenues=e.currentUser().venues,i.venuePhones=[],i.stories=h.stories,i.buttonAssignments=["1","2","3","4","5","6","7","8","9"],i.getVenue=function(a){f.fetchOne(a).then(function(a){angular.copy(a,i.venue),i.getPhones(i.venue.id)})},i.getPhones=function(a){g.fetch(a).then(function(a){angular.copy(a,i.venuePhones)})},i.isActive=function(a){return c.path()===a},i.submit=function(a){for(var b in a)switch(b){case"button":g.assignButton(a).then(function(a){i.buttonToEdit=null,i.getPhones(i.venue.id)})}},i.editButton=function(a,b,c){i.buttonToEdit=b,i.buttonToEdit.assignment=a,i.buttonToEdit.phone_id=c},d.venueId)i.getVenue(d.venueId);else{var j=i.userVenues.filter(function(a){return null!==a.number_phones?a:void 0});i.getVenue(j[0].id)}}function phoneController(a,b,c,d,e,f,g,h){var i=this;i.currentPhone={},i.venues=[],i.ishmaelStories=[],i.availableStories=[],e.fetch(a.currentUser.venues[0].id).then(function(a){angular.copy(a[0],i.currentPhone),j(),l()}),i.clearButton=function(a,b,c,d){"undefined"!=typeof a.value.story_id&&k(a.value.story_id),a.value.story_id="",a.value.title="",a.value.created_at="",a.value.url=""},i.isFixed=function(a){for(var b in a)return"*"===b||"#"===b||"0"===b||"PR"===b},b.$on("droppedElement",function(a,c){var d,f,g=c.dragObj,h=c.dropObj;f=p(h),q(g);for(var i in f)d=f[i].story_id,f[i].title=g.title,f[i].url=g.url,f[i].story_id=g.id;"undefined"!=typeof d&&b.$apply(k(d)),e.assignButton(f).then(function(a){})});var j=function(){d.fetch().then(function(a){m(o(a))})},k=function(a){d.fetchOne(a).then(function(a){i.availableStories.push(a)})},l=function(){angular.forEach(a.currentUser.venues,function(a,b,c){f.fetchOne(a.id).then(function(a){i.venues.push(a),m(a.stories)})})},m=function(a){angular.forEach(a,function(a,b,c){n(a.id)||i.availableStories.push(a)})},n=function(a){var b=i.currentPhone.buttons.filter(function(b,c,d){var e=Object.getOwnPropertyNames(b)[0],f=b[e].story_id.toString();return f===a.toString()});return b.length>0},o=function(a){return a.filter(function(a){return"ishmaels"===a.story_type?a:void 0})},p=function(a){return i.currentPhone.buttons.filter(function(b,c,d){for(var e in b)if(e===Object.keys(a)[0])return b})[0]},q=function(a){angular.forEach(i.availableStories,function(b,c){b.id===a.id&&i.availableStories.splice(c,1)})}}function userController(a,b,c,d){var e=this;e.users=c.users,e.updateUser=function(a){a.id=e.currentUser.id,c.updateUser(a).then(function(a){f()}),e.user={}},e.deleteUser=function(a){c.deleteUser(a).then(function(a){c.fetchUsers()})};var f=function(){e.currentUser=c.currentUser()};f()}angular.module("MainController",[]),angular.module("MainDirective",[]),angular.module("phoneApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","720kb.datepicker","MainDirective","MainController"]).run(["$rootScope","$routeParams","$window","$http","$location","AuthFactory","VenueFactory","PhoneFactory","StoryFactory","trace",function(a,b,c,d,e,f,g,h,i,j){if(g.fetch(),h.get(),i.fetch(),f.fetchUsers(),f.isAuthenticated()||"/confirm"!==e.path())if(f.isAuthenticated()||"/passwordreset"!==e.path())if(f.isAuthenticated()){var k=JSON.parse(c.localStorage.getItem("cmi-user"));d.defaults.headers.common.Authorization="Token token="+k.token}else e.path("/");else j("location is /passwordreset and there is no currentUser");else j("all is well");a.$on("$routeChangeStart",function(a,b){if("/confirm"!==e.path()||f.isAuthenticated())if(f.isAuthenticated()||"/passwordreset"!==e.path())if(f.isAuthenticated()){var g=JSON.parse(c.localStorage.getItem("cmi-user"));d.defaults.headers.common.Authorization="Token token="+g.token}else e.path("/");else j("location is /passwordreset and there is no currentUser");else j("all is well");f.isAuthenticated()&&"venue_admin"===f.currentUser().role&&"/dashboard"===e.path()&&e.path("/venues")}),f.isAuthenticated()&&"venue_admin"===f.currentUser().role&&"/dashboard"===e.path()&&e.path("/phones")}]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","https://s3-us-west-2.amazonaws.com/**","https://callmeishmael-files.s3.amazonaws.com/**"])}]),angular.module("phoneApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeController",controllerAs:"homeController"}).when("/dashboard",{templateUrl:"views/dashboard.html"}).when("/venue-stats",{templateUrl:"views/venue.html"}).when("/phone-stats",{templateUrl:"views/admin-phone.html"}).when("/story-stats",{templateUrl:"views/stories.html"}).when("/user-stats",{templateUrl:"views/user-management.html",controller:"UserController",controllerAs:"userController"}).when("/phones",{templateUrl:"views/phone-show.html"}).when("/manage-phone",{templateUrl:"views/manage-phone.html",controller:"PhoneController",controllerAs:"phoneController"}).when("/confirm",{templateUrl:"views/confirm.html",controller:"LoginController",controllerAs:"loginController"}).when("/your-account",{templateUrl:"views/user.html",controller:"UserController",controllerAs:"userController"}).when("/passwordreset",{templateUrl:"views/resetpassword.html",controller:"LoginController",controllerAs:"loginController"}).otherwise({redirectTo:"/phones"})}]),angular.module("phoneApp").constant("_",window._).constant("ServerUrl","https://callmeishmael-api.herokuapp.com").constant("AmazonBucket","https://callmeishmael-files.s3.amazonaws.com/"),angular.module("phoneApp").service("trace",function(){return function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])}}),angular.module("phoneApp").service("storyTypes",function(){return function(){return["Fixed","Venue","Surprise","Ishmael’s"]}}),angular.module("phoneApp").filter("storyFilter",["trace","StoryFactory",function(a,b){return function(a,b){var c=[],d=b||"^$",e=new RegExp("("+d+")","ig");return angular.forEach(a,function(a,b){var d=a.title.search(e),f=a.author_last.search(e);(-1!==d||-1!==f)&&c.push(a)}),c}}]),angular.module("phoneApp").filter("reverse",function(){return function(a){return"undefined"!=typeof a?a.slice().reverse():void 0}}),angular.module("phoneApp").factory("AuthFactory",["$location","$rootScope","$http","$window","$q","ServerUrl","trace",function(a,b,c,d,e,f,g){var h=[],i=function(){return e(function(a,d){c.get(f+"/admin/users").success(function(b){angular.copy(b,h),a(b)}).error(function(a,c,e,f){d(a),b.alert="Unsuccessful attempt to retreive all users because:"+a+"\n"+c})})},j=function(a){return c.post(f+"/login",a).success(function(a,c,e,f){s(a),b.currentUser=JSON.parse(d.localStorage.getItem("cmi-user")),b.$broadcast("alert",{alert:"Log in successful.",status:c})}).error(function(a,c,d,e){b.$broadcast("alert",{alert:"Your email and/or password are incorrect.",status:c})})},k=function(){return c.get(f+"/logout").success(function(a,c,e,f){g(a),d.localStorage.removeItem("cmi-user"),b.currentUser=null,b.$broadcast("alert",{alert:"You have successfully logged out.",status:c})})},l=function(){return!!d.localStorage.getItem("cmi-user")},m=function(a){return c.post(f+"/admin/users",a).success(function(a,c,d,e){b.$broadcast("alert",{alert:"New user successfully created.",status:c})}).error(function(a,c,d,e){b.$broadcast("alert",{alert:"There was a problem with your request: "+a,status:c})})},n=function(a){return c.patch(f+"/admin/users/"+a.id,{user:a}).success(function(a,c,d,e){b.confirmed=!0,b.$broadcast("alert",{alert:"User: "+a.firstname+" "+a.lastname+" updated successfully.",status:c}),s(a)}).error(function(a,c,d,e){b.$broadcast("alert",{alert:"There was a problem and the user was not updated successfully: "+a,status:c})})},o=function(a){return e(function(d,e){c["delete"](f+"/admin/users/"+a).success(function(a,c,e,f){b.$broadcast("alert",{alert:"User deleted.",status:c}),d(a,c,e,f)}).error(function(a,c,d,f){b.$broadcast("alert",{alert:"Failed to delete user.",status:c}),e(a,c,d,f)})})},p=function(){return b.currentUser=JSON.parse(d.localStorage.getItem("cmi-user"))},q=function(a){return c.get(f+"/resetpassword?email="+a.email)},r=function(a){return c.patch(f+"/admin/users/"+a.id,{user:a}).success(function(a,c,d,e){g(a),b.$broadcast("alert",{alert:"Your password was successfully changed.",status:c})}).error(function(a,c,d,e){g("error changing new password: ",a,c,d,e),b.$broadcast("alert",{alert:"Your password was not successfully changed.",status:c})})},s=function(a){d.localStorage.setItem("cmi-user",JSON.stringify(a)),c.defaults.headers.common.Authorization="Token token="+a.token};return{users:h,fetchUsers:i,login:j,logout:k,isAuthenticated:l,postNewUser:m,updateUser:n,deleteUser:o,currentUser:p,sendPasswordLink:q,submitNewPassword:r}}]),angular.module("phoneApp").factory("PhoneFactory",["trace","$rootScope","$http","$q","ServerUrl",function(a,b,c,d,e){var f=[],g=function(b){return d(function(d,f){c.get(e+"/venues/"+b+"/phones").success(function(a,b,c,e){d(a)}).error(function(b,c,d,e){f(b,c,d,e),a(b,c,d,e,"phone request failed.")})})},h=function(){return d(function(a,b){c.get(e+"/phones").success(function(b,c,d,e){angular.copy(b,f),a(b)}).error(function(a,c,d,e){b(a)})})},i=function(a){return d(function(d,f){c.post(e+"/venues/"+a.phone.venueId+"/phones",a).success(function(a,c,e,f){b.$broadcast("alert",{alert:"The phone has been created.",status:c}),d(a)}).error(function(a,c,d,e){b.$broadcast("alert",{alert:"There was an error and the requested action failed.",status:c}),f(a,c,d,e)})})},j=function(a){return d(function(d,f){c["delete"](e+"/venues/"+a.phone.venue.id+"/phones/"+a.phone.id).success(function(a,c,e,f){b.$broadcast("alert",{alert:"The phone has been deleted.",status:c}),d(a)}).error(function(a,c,d,e){b.$broadcast("alert",{alert:"There was an error and the requested action failed.",status:c}),f(a,c,d,e)})})},k=function(a){var f,g;for(var h in a)f=a[h].button_id.toString(),g=a[h].story_id.toString();return d(function(a,d){c.patch(e+"/buttons/"+f,{button:{story_id:g}}).success(function(c,d,e,f){b.$broadcast("alert",{alert:"Button "+c.assignment+" was successfully changed to "+c.story.title+". Changes to your phone will take effect tomorrow.",status:d}),a(c)}).error(function(a,c,e,f){b.$broadcast("alert",{alert:"Sorry, there was an issue with that request.",status:c}),d(a,c,e,f)})})};return{fetch:g,phones:f,get:h,post:i,assignButton:k,destroy:j}}]),angular.module("phoneApp").factory("VenueFactory",["trace","$window","$rootScope","ServerUrl","$q","$http",function(a,b,c,d,e,f){var g=[],h=function(){return e(function(a,b){f.get(d+"/venues").success(function(b){return angular.copy(b,g),a(b)}).error(function(a,c,d,e){return b(a,c,d,e)})})},i=function(a){return e(function(b,c){f.get(d+"/venues/"+a).success(function(a){b(a)}).error(function(a,b,d,e){c(a,b,d,e)})})},j=function(a){return a.venue.user_ids=n(a.venue.user_ids),e(function(b,e){f.post(d+"/venues",a).success(function(a){c.alert="Your venue was successfully created",b(a)}).error(function(a,b,d,f){c.alert="Sorry, there was an issue with that request: Status "+b,e(a)})})},k=function(a,b){return e(function(e,g){f.put(d+"/venues/"+b,a).success(function(a,b,d,f){c.$broadcast("alert",{alert:"Venue "+a.name+" updated",status:b}),e(a,b,d,f)}).error(function(a,b,d,e){c.$broadcast("alert",{alert:"Update failed.",status:b}),g(a,b,d,e)})})},l=function(a,b){var g={venue:{story_ids:[b]}};return e(function(b,e){f.patch(d+"/venues/"+a,g).success(function(a,d,e,f){c.$broadcast("alert",{alert:"The story was added successfully",status:d}),b(a,d,e,f)}).error(function(a,b,c,d){e(a,b,c,d)})})},m=function(a){return e(function(b,e){f["delete"](d+"/venues/"+a.venue.id).success(function(a){c.alert="Your venue was successfully deleted",b(a)}).error(function(a,b,d,f){c.alert="Sorry, there was an issue with that request: Status "+b,e(a)})})},n=function(a){var b=[];for(var c in a)a[c].checked&&b.push(c);return b};return{fetch:h,fetchOne:i,venues:g,post:j,addStoryToVenue:l,patch:k,destroy:m}}]),angular.module("phoneApp").factory("StoryFactory",["trace","$window","$rootScope","ServerUrl","$q","$http","AWSFactory","AmazonBucket",function(a,b,c,d,e,f,g,h){var i=[],j=function(){return e(function(b,c){f.get(d+"/stories").success(function(a){angular.copy(a,i),b(a)}).error(function(b,c,d,e){a(b,c,d,e)})})},k=function(b){return e(function(c,e){f.get(d+"/stories/"+b).success(function(a){c(a)}).error(function(b,c,d,f){a(b,c,d,f),e(b,c,d,f)})})},l=function(a,b){return a.story.story_type=n(a.story.story_type),b&&(a.story.url=b),e(a.story.id?function(b,e){f.put(d+"/stories/"+a.story.id,a).success(function(a,d,e,f){c.$broadcast("alert",{alert:"The story "+a.title+" was updated successfully",status:d}),b(a,d,e,f)}).error(function(b,d,f,g){c.$broadcast("alert",{alert:"The story "+a.title+" failed to update.",status:d}),e(b,d,f,g)})}:function(b,e){f.post(d+"/stories",a).success(function(a,d,e,f){c.$broadcast("alert",{alert:"The story was created successfully.",status:d}),b(a)}).error(function(a,b,d,f){c.$broadcast("alert",{alert:"There was an error and the story was not created successfully.",status:b}),e(a,b,d,f)})})},m=function(a){return e(function(b,e){f["delete"](d+"/stories/"+a.story.id).success(function(d,e,f,g){c.$broadcast("alert",{alert:"Story "+a.story.title+" was successfully deleted",status:e}),b(d)}).error(function(a,b,c,d){e({data:a,status:b,headers:c,config:d})})})},n=function(a){return a?a.toLowerCase().replace(/[\-\s\—\–\”’“‘\',;]/,""):void 0};return{fetch:j,fetchOne:k,stories:i,post:l,destroy:m,normalize:n}}]),angular.module("phoneApp").factory("AWSFactory",["$http","$q","$rootScope","ServerUrl","AmazonBucket","trace",function(a,b,c,d,e,f){var g=function(c){var e="?filename="+c.name+"&filetype="+c.type;return b(function(b,c){a.get(d+"/amazon/sign_key"+e).success(function(a,c,d,e){return b(a)}).error(function(a,b,d,e){return c(a,b,d.config)})})},h=function(b){return g(b).then(function(d){a.post(e,i(b,d),{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:""}}).success(function(a,b,d,e){return c.awsResponse={response:a,status:b,headers:d,config:e},{response:a,status:b,headers:d,config:e}}).error(function(a,b,d,e){return c.$broadcast("alert",{alert:"There was an error: \nResponse: "+a+"\nStatus: "+b,status:b}),{response:a,status:b,headers:d,config:e}})})},i=function(a,b){var c=new FormData;return c.append("key",b.key),c.append("AWSAccessKeyId",b.access_key),c.append("policy",b.policy),c.append("acl","public-read"),c.append("signature",b.signature),c.append("Content-Type",a.type),c.append("file",a),c};return{sendToAmazon:h}}]),angular.module("phoneApp").filter("venuesFilter",["trace",function(a){}]),angular.module("MainDirective").directive("navbar",["trace",function(a){return{restrict:"E",templateUrl:"views/navbar.html",controller:"NavbarController",controllerAs:"navbarController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("sidenav",["trace",function(a){return{restrict:"E",templateUrl:"views/sidenav.html",controller:"SidenavController",controllerAs:"sidenavController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("cmiDashboard",["trace",function(a){return{restrict:"E",templateUrl:"views/admin-dashboard.html",controller:"DashboardController",controllerAs:"dashboardController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("cmiPhoneShowDashboard",["trace",function(a){return{restrict:"E",scope:"=",templateUrl:"views/phone-show-dashboard.html",controller:"VenueController",controllerAs:"venueController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("cmiAdminPhoneDashboard",["PhoneFactory","trace",function(a,b){return{restrict:"E",templateUrl:"views/admin-phone-dashboard.html",controller:"DashboardController",controllerAs:"dashboardController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("cmiStoryDashboard",["trace","$rootScope",function(a,b){return{restrict:"E",templateUrl:"views/story-dashboard.html",controller:"DashboardController",controllerAs:"dashboardController",bindToController:!0,link:function(a,c,d){var e=$("#storyStatusSelect"),f=$("#storyVenueField");f.hide(),e.on("change",function(a){"venue"===this.value.replace(/\s/,"")?f.show():f.hide().val("")}),a.editStory=function(a){b.$broadcast("editStory",{story:a})}}}}]),angular.module("MainDirective").directive("cmiFormsDashboard",["trace",function(a){return{restrict:"E",templateUrl:"views/forms-dashboard.html",controller:"FormsController",controllerAs:"formsController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("ngConfirmClick",["trace","$window",function(a,b){return{restrict:"A",replace:!1,scope:"=",link:function(a,c,d){var e=d.ngConfirmClick||"Are you sure?",f=d.confirmedClickAction;c.bind("click",function(c){b.confirm(e)&&a.$eval(f)})}}}]),angular.module("MainDirective").directive("cmiVenueDashboard",["VenueFactory","trace",function(a,b){return{restrict:"E",templateUrl:"views/venue-dashboard.html",controller:"DashboardController",controllerAs:"dashboardController",bindToController:!0,link:function(a,b,c){}}}]),angular.module("MainDirective").directive("ajaxSpinner",["trace","$http",function(a,b){return{restrict:"A",link:function(a,c,d){a.isLoading=function(){return b.pendingRequests.length>0},a.$watch(a.isLoading,function(a){a?(c.addClass("active").find("i.fa").addClass("fa-cog fa-spin"),$("html, body").addClass("ajax-progress")):(c.removeClass("active").find("i.fa").removeClass("fa-cog fa-spin"),$("html, body").removeClass("ajax-progress"))})}}}]),angular.module("MainDirective").directive("cmiDialListitem",["trace","$compile",function(a,b){return{restrict:"EA",scope:{button:"="},compile:function(){return function(a,b,c){var d,e;a.$watch("button",function(a,c){0===Object.keys(a).length,d=b.find(".button-story"),e=b.find(".button-story .audio audio")})}}}}]),angular.module("MainDirective").directive("cmiAudioPlayer",["$rootScope","trace",function(a,b){return{restrict:"E",templateUrl:"views/audio-player.html",scope:{url:"@"},compile:function(){return function(a,b,c){var d=b.find("audio");a.toggleAudio=function(){a.playing===!0?d[0].pause():d[0].play(),a.playing=!a.playing}}}}}]),angular.module("MainDirective").directive("cmiDraggable",["$rootScope","trace",function(a,b){return{restrict:"EA",compile:function(){return function(a,b,c){$(b).draggable({cursor:"pointer",revert:"invalid",drag:function(a,b){},start:function(a,b){},stop:function(a,b){}}),a.$last&&a.$emit("onRepeatDone",{e:b,a:c})}}}}]),angular.module("MainDirective").directive("cmiDroppable",["$rootScope","trace",function(a,b){return{restrict:"EA",scope:{button:"="},compile:function(){return function(b,c,d){setTimeout(function(){$(c).droppable({drop:function(c,d){var e,f=angular.element(d.draggable).data("uid"),g=(angular.element(d.draggable).parent(),angular.element(this),$(d.draggable).offset().left-$(this).offset().left),h=$(d.draggable).offset().top-$(this).offset().top,i=parseInt($(d.draggable).css("left"))-g,j=parseInt($(d.draggable).css("top"))-h,k=parseInt($(this).css("width")),l=parseInt($(this).css("height"));$(d.draggable).animate({width:k,height:l,top:j,left:i},100,function(){$(this).fadeOut(400,function(){$(this).remove()})}),e=b.$parent.phoneController.availableStories.filter(function(a,b,c){return a.id===f?a:void 0})[0],a.$broadcast("droppedElement",{dragObj:e,dropObj:b.button}),b.$apply()},hoverClass:"cmi-droppable-hover",revert:"invalid",disabled:$(c).hasClass("nonEditable")})},1e3)}}}}]),angular.module("MainDirective").directive("cmiAlert",["$rootScope","trace",function(a,b){return{restrict:"E",templateUrl:"views/alert.html",link:function(a,b,c){a.dismissAlert=function(){var b=$(".alert");b.fadeOut(250,function(){a.alert=""})},a.$on("alert",function(b,c){a.alert=c.alert,a.status=c.status,setTimeout(function(){a.dismissAlert()},1e4)})}}}]),angular.module("MainDirective").directive("sticky",["$rootScope","$window","trace",function(a,b,c){return{restrict:"EA",link:function(a,c,d){angular.element(b).bind("scroll",function(){var a=b.pageYOffset,d=$(c).offset().top,e=$(c).parent().offset().top,f=d-a,g=e-a,h=c.width();0>=f&&($(c).addClass("sticky"),c.width(h)),g>0&&($(c).removeClass("sticky"),c.width(""))})}}}]),angular.module("MainDirective").directive("paginate",["$rootScope","$window","trace",function(a,b,c){return{restrict:"EA",link:function(a,c,d,e,f){var g=(c.height(),b.innerHeight);a.$on("onRepeatDone",function(b,d){a.totalChildren=c.children().length}),a.$watch("totalChildren",function(b,e){if(b>d.maxItems){for(var f=Math.ceil(a.totalChildren/d.maxItems),h=c.find(".pagination"),i="",j=1;f>=j;j++)i+="<li><a data-page="+j.toString()+">"+j.toString()+"</a></li>";$(h).html(i),$(c[0].parentElement).height()>g&&(c.height(g),h.addClass("fixed"))}})},controller:["$scope","$element",function(a,b){}]}}]),angular.module("MainController").controller("NavbarController",navbarController),navbarController.$inject=["trace","$location","AuthFactory"],angular.module("MainController").controller("LoginController",loginController),loginController.$inject=["$rootScope","$location","AuthFactory","trace"],angular.module("MainController").controller("SidenavController",sidenavController),sidenavController.$inject=["trace","$location","$routeParams"],angular.module("MainController").controller("DashboardController",dashboardController),dashboardController.$inject=["trace","VenueFactory","PhoneFactory","StoryFactory","storyTypes"],angular.module("MainController").controller("HomeController",homeController),homeController.$inject=["trace","$location","AuthFactory"],angular.module("MainController").controller("FormsController",formsController),formsController.$inject=["trace","$q","AuthFactory","PhoneFactory","StoryFactory","VenueFactory","AWSFactory","$rootScope","$scope"],angular.module("MainController").controller("VenueController",venueController),venueController.$inject=["trace","$rootScope","$location","$routeParams","AuthFactory","VenueFactory","PhoneFactory","StoryFactory"],angular.module("MainController").controller("PhoneController",phoneController),phoneController.$inject=["$rootScope","$scope","AuthFactory","StoryFactory","PhoneFactory","VenueFactory","$sceDelegate","trace"],angular.module("MainController").controller("UserController",userController),userController.$inject=["$rootScope","$scope","AuthFactory","trace"];